---
import Button from "./Button.astro";
import { SERVICES } from "../types/services";
---

<div class="flex flex-col items-center px-6 xl:px-16 relative" id="card-conteiner-el">
    {
        SERVICES.map(({ id, title, text }, index ) => (
            <div 
                class="card-el bg-theme-lights text-theme-purple shadow-theme-box py-6 sm:py-8 md:py-12 px-4 sm:px-10 md:px-14  rounded-3xl sticky border border-white/20 mb-40 w-full sm:max-w-[86%] md:max-w-[64%]" 
                style={`top: ${ 40 + index * 25 }px;`}
            >
                <h1 class="cards-title md:mb-8 border-b-2 border-theme-purple pb-8 text-4xl font-bold">
                    {title}
                </h1>
                <div class="flex flex-col md:flex-row justify-evenly items-center py-6">
                    <img 
                        class="w-36 sm:w-48 md:w-56 mb-8 md:mb-0 aspect-square object-contain" 
                        src={`web-projects/services/${id}.png`}
                        alt={`Icon for ${title}`}
                    />
                    <div class="flex flex-col w-full md:w-1/2 justify-center">
                        <p class="prg hidden sm:flex md:visible mb-6  xl:mb-10 text-lg max-w-xl">
                            {text}
                        </p>
                        <div class="xl:w-1/2">
                            <Button href={`/services/${id}`} text="Let's grow" />
                        </div>
                    </div>
                </div>
            </div>
        ))
    }
</div>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    document.addEventListener("DOMContentLoaded", () => {
        gsap.registerPlugin(ScrollTrigger);

        const cards = gsap.utils.toArray(".card-el") as HTMLElement[ ];
        const totalCards = cards.length;
        
        cards.forEach((card, index) => {

            if ( index === cards.length - 1 ) return;
            const nextCard = cards[index + 1];
            const scaleFactor = 0.05; 
            const targetScale = 1 - ( totalCards - index ) * scaleFactor

            gsap.to(card, {
                scale: targetScale, 
                transformOrigin: "top center",
                ease: "none",
                scrollTrigger: {
                    trigger: cards[index + 1], 
                    start: "top 80%", 
                    end: "top 20%",
                    scrub: true,
                }
            });
        });
    });
</script>